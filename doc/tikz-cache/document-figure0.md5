\begingroup \toks 0={macro:-> \fill [fill=yellow, opacity=0.25] (-5.5,4) rectangle (5,7); \fill [fill=green, opacity=0.25] (-5.5,-3.5) rectangle (5,4); \fill [fill=blue, opacity=0.25] (5,-3.5) rectangle (10,2); \begin {pgfonlayer}{nodelayer} \node [rounded corners=8pt, inner sep=16pt, style=rect] (0) at (8, -1) {8 Electrodes}; \node [rounded corners=8pt, inner sep=16pt, style=rect] (1) at (0, 3) {Microcontroller}; \node [rounded corners=8pt, inner sep=16pt, style=rect] (2) at (-3, -1) {MinieC Interface}; \node [rounded corners=8pt, inner sep=16pt, style=rect] (3) at (3, 0.25) {Matrix Switch}; \node [rounded corners=8pt, inner sep=16pt, style=rect] (4) at (0, 6) {PC}; \node [style=rect, inner sep=16pt, rounded corners=8pt] (5) at (3, -2.25) {Matrix Switch}; \end {pgfonlayer} \begin {pgfonlayer}{edgelayer} \draw [style=darrow] (4) to node[left]{USB} (1); \draw [style=simple, bend right=15, looseness=1.00] (0) to node[above]{8 SIG} (3); \draw [style=simple, bend right=15, looseness=1.00] (3) to node[above]{SIG} (2); \draw [style=arrow, bend left=15, looseness=1.00] (1) to node[right]{SPI} (3); \draw [style=darrow, bend right=15, looseness=1.00] (1) to node[left]{I2C} (2); \draw [style=simple, bend right=15, looseness=1.00] (2) to node[below]{GND} (5); \draw [style=simple, bend right=15, looseness=1.00] (5) to node[below]{8 GND} (0); \draw [style=arrow, bend left=15, looseness=1.00] (1) to node[right, pos=0.9]{SPI} (5); \end {pgfonlayer} \draw (-5.5,-3.5) -- (10,-3.5) -- (10,2) node[below, left, yshift=-8pt] {$n$} -- (-5.5,2) -- (-5.5,-3.5); }\xdef \tikzexternallastkey {\the \toks 0 }\endgroup %
